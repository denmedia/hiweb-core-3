!function(){var p=tinymce.util.Tools.resolve("tinymce.PluginManager"),m=function(a){return/^[A-Za-z][A-Za-z0-9\-:._]*$/.test(a)},j=function(a){var c=a.selection.getNode();return"A"===c.tagName&&""===a.dom.getAttrib(c,"href")?c.id||c.name:""},h=function(a,c){var d=a.selection.getNode();"A"===d.tagName&&""===a.dom.getAttrib(d,"href")?(d.removeAttribute("name"),d.id=c,a.undoManager.add()):(a.focus(),a.selection.collapse(!0),a.execCommand("mceInsertContent",!1,a.dom.createHTML("a",{id:c})))},g=function(c){var a=j(c);c.windowManager.open({title:"Anchor",body:{type:"textbox",name:"id",size:40,label:"Id",value:a},onsubmit:function(d){var i,r,q=d.data.id;i=c,(m(r=q)?(h(i,r),0):(i.windowManager.alert("Id should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),1))&&d.preventDefault()}})},f=function(a){a.addCommand("mceAnchor",function(){g(a)})},b=function(a){return function(c){for(var d=0;d<c.length;d++){(i=c[d]).attr("href")||!i.attr("id")&&!i.attr("name")||i.firstChild||c[d].attr("contenteditable",a)}var i}},l=function(a){a.on("PreInit",function(){a.parser.addNodeFilter("a",b("false")),a.serializer.addNodeFilter("a",b(null))})},k=function(a){a.addButton("anchor",{icon:"anchor",tooltip:"Anchor",cmd:"mceAnchor",stateSelector:"a:not([href])"}),a.addMenuItem("anchor",{icon:"anchor",text:"Anchor",context:"insert",cmd:"mceAnchor"})};p.add("anchor",function(a){l(a),f(a),k(a)})}();