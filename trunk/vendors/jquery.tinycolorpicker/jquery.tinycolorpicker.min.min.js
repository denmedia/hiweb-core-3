(function(b){if(typeof define==="function"&&define.amd){define(["jquery"],b)}else{if(typeof exports==="object"){module.exports=b(require("jquery"))}else{b(jQuery)}}}(function(h){var e="tinycolorpicker",g={colors:["#ffffff","#A7194B","#FE2712","#FB9902","#FABC02","#FEFE33","#D0EA2B","#66B032","#0391CE","#0247FE","#3D01A5","#8601AF"],backgroundUrl:null};function f(H,F){this.options=h.extend({},g,F);this._defaults=g;this._name=e;var G=this,C=H.find(".track"),A=H.find(".color"),b=null,v=H.find(".colorInput"),d=H.find(".dropdown"),E=d.find("li").remove(),D=null,y=false,B=!!document.createElement("canvas").getContext,w="ontouchstart" in document.documentElement;this.colorHex="";this.colorRGB="";function z(){if(B){b=h("<canvas></canvas>");C.append(b);D=b[0].getContext("2d");a()}else{h.each(G.options.colors,function(j,k){var i=E.clone();i.css("backgroundColor",k);i.attr("data-color",k);d.append(i)})}c();return G}function a(){var j=new Image(),i=C.css("background-image").replace(/"/g,"").replace(/url\(|\)$/ig,"");j.crossOrigin="Anonymous";C.css("background-image","none");h(j).load(function(){b.attr("width",this.width);b.attr("height",this.height);D.drawImage(j,0,0,this.width,this.height)});j.src=G.options.backgroundUrl||i}function c(){var i=w?"touchstart":"mousedown";if(B){A.bind(i,function(j){j.preventDefault();j.stopPropagation();C.toggle();h(document).bind("mousedown.colorpicker",function(k){h(document).unbind(".colorpicker");G.close()})});if(!w){b.mousedown(function(j){y=true;x(j);h(document).bind("mouseup.colorpicker",function(k){h(document).unbind(".colorpicker");G.close();return false});return false});b.mousemove(x)}else{b.bind("touchstart",function(j){y=true;x(j.originalEvent.touches[0]);return false});b.bind("touchmove",function(j){x(j.originalEvent.touches[0]);return false});b.bind("touchend",function(j){G.close();return false})}}else{A.bind("mousedown",function(j){j.preventDefault();j.stopPropagation();d.toggle()});d.delegate("li","mousedown",function(j){j.preventDefault();j.stopImmediatePropagation();var k=h(this).attr("data-color");G.setColor(k);d.hide()})}}function x(i){if(y){var k=h(i.target),l=k.offset(),j=D.getImageData(i.pageX-l.left,i.pageY-l.top,1,1).data;G.setColor("rgb("+j[0]+","+j[1]+","+j[2]+")");H.trigger("change",[G.colorHex,G.colorRGB])}}this.setColor=function(i){if(i.indexOf("#")>=0){G.colorHex=i;G.colorRGB=G.hexToRgb(G.colorHex)}else{G.colorRGB=i;G.colorHex=G.rgbToHex(G.colorRGB)}A.find(".colorInner").css("backgroundColor",G.colorHex);v.val(G.colorHex)};this.close=function(){y=false;C.hide()};this.hexToRgb=function(i){var j=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);return"rgb("+parseInt(j[1],16)+","+parseInt(j[2],16)+","+parseInt(j[3],16)+")"};this.rgbToHex=function(j){var k=j.match(/\d+/g);function i(m){var l=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F");return isNaN(m)?"00":l[(m-m%16)/16]+l[m%16]}return"#"+i(k[0])+i(k[1])+i(k[2])};return z()}h.fn[e]=function(a){return this.each(function(){if(!h.data(this,"plugin_"+e)){h.data(this,"plugin_"+e,new f(h(this),a))}})}}));