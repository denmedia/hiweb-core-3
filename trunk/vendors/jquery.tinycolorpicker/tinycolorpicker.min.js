(function(c,f){function g(){for(var j=1;j<arguments.length;j++){for(var h in arguments[j]){if(arguments[j].hasOwnProperty(h)){arguments[0][h]=arguments[j][h]}}}return arguments[0]}var d="tinycolorpicker",e={backgroundUrl:null};function b(v,x){this.options=g({},e,x);this._defaults=e;this._name=d;var w=this,i=v.querySelectorAll(".track")[0],k=v.querySelectorAll(".color")[0],u=v.querySelectorAll(".colorInner")[0],r=null,p=v.querySelectorAll(".colorInput")[0],h=null,m=false,j=!!document.createElement("canvas").getContext,o="ontouchstart" in document.documentElement,s=document.createEvent("HTMLEvents");s.initEvent("change",true,true);this.colorHex="";this.colorRGB="";function l(){if(j){r=document.createElement("canvas");i.appendChild(r);h=r.getContext("2d");t()}q();return w}function t(){var y=new Image(),z=i.currentStyle||c.getComputedStyle(i,false),A=z.backgroundImage.replace(/"/g,"").replace(/url\(|\)$/ig,"");y.crossOrigin="Anonymous";i.style.backgroundImage="none";y.onload=function(){r.width=this.width;r.height=this.height;h.drawImage(y,0,0,this.width,this.height)};y.src=w.options.backgroundUrl||A}function q(){var y=o?"touchstart":"mousedown";if(j){k["on"+y]=function(z){z.preventDefault();z.stopPropagation();i.style.display="block";document.onmousedown=function(A){document.onmousedown=null;w.close()}};if(!o){r.onmousedown=function(z){z.preventDefault();z.stopPropagation();m=true;n(z);document.onmouseup=function(A){document.onmouseup=null;w.close();return false}};r.onmousemove=n}else{r.ontouchstart=function(z){m=true;n(z.touches[0]);return false};r.ontouchmove=function(z){n(z.touches[0]);return false};r.ontouchend=function(z){w.close();return false}}}}function n(z){if(m){var A=z.target.getBoundingClientRect(),y=h.getImageData(z.clientX-A.left,z.clientY-A.top,1,1).data;w.setColor("rgb("+y[0]+","+y[1]+","+y[2]+")");v.dispatchEvent(s,[w.colorHex,w.colorRGB])}}this.setColor=function(y){if(y.indexOf("#")>=0){w.colorHex=y;w.colorRGB=w.hexToRgb(w.colorHex)}else{w.colorRGB=y;w.colorHex=w.rgbToHex(w.colorRGB)}u.style.backgroundColor=w.colorHex;p.value=w.colorHex};this.close=function(){m=false;i.style.display="none"};this.hexToRgb=function(z){var y=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(z);return"rgb("+parseInt(y[1],16)+","+parseInt(y[2],16)+","+parseInt(y[3],16)+")"};this.rgbToHex=function(z){var y=z.match(/\d+/g);function A(B){var C=new Array("0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F");return isNaN(B)?"00":C[(B-B%16)/16]+C[B%16]}return"#"+A(y[0])+A(y[1])+A(y[2])};return l()}var a=function(i,h){return new b(i,h)};if(typeof define=="function"&&define.amd){define(function(){return a})}else{if(typeof module==="object"&&module.exports){module.exports=a}else{c.tinycolorpicker=a}}})(window);