var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,c,e){a instanceof String&&(a=String(a));for(var b=a.length,d=0;d<b;d++){var f=a[d];if(c.call(e,f,d,a))return{i:d,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,e){a!=Array.prototype&&a!=Object.prototype&&(a[c]=e.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,c,e,b){if(c){e=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var d=a[b];d in e||(e[d]={});e=e[d]}a=a[a.length-1];b=e[a];c=c(b);c!=b&&null!=c&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,e){return $jscomp.findInternal(this,a,e).v}},"es6","es3");
var hiweb_field_repeat={selector:".hiweb-field-repeat",selector_source:"[data-row-source]",selector_wrap:"tbody.wrap",selector_row:"[data-row]",selector_button_add:"[data-action-add]",selector_button_clear:"[data-action-clear]",selector_button_remove:"[data-action-remove]",selector_button_duplicate:"[data-action-duplicate]",init:function(a){hiweb_field_repeat.make_sortable(a);jQuery(a).find("> table > thead .dropdown, > table > tfoot .dropdown").dropdown({action:"hide"});0===jQuery(a).parent().closest(hiweb_field_repeat.selector).length&&
hiweb_field_repeat.set_input_names(a)},init_once:function(){jQuery(hiweb_field_repeat.selector).each(function(){hiweb_field_repeat.init(this)});jQuery("body").on("click",hiweb_field_repeat.selector+" "+hiweb_field_repeat.selector_button_add,hiweb_field_repeat.click_add).on("click",hiweb_field_repeat.selector+" "+hiweb_field_repeat.selector_button_remove,hiweb_field_repeat.click_remove).on("click",hiweb_field_repeat.selector+" "+hiweb_field_repeat.selector_button_duplicate,hiweb_field_repeat.click_duplicate).on("click",
hiweb_field_repeat.selector+" "+hiweb_field_repeat.selector_button_clear,hiweb_field_repeat.click_clear_full)},get_row_source:function(a){return jQuery(a).find("> table > tbody[data-rows-source] > tr[data-row]")},get_rows_list:function(a){return jQuery(a).find("> table > tbody[data-rows-list]")},get_rows:function(a){return jQuery(a).find("> table > tbody[data-rows-list] > tr[data-row]")},get_cols:function(a){return jQuery(a).find("> table > thead [data-col]")},get_cols_by_row:function(a){return jQuery(a).find("> [data-col], > td > [data-col], > td > table > tbody > tr > [data-col]")},
make_sortable:function(a){var c=hiweb_field_repeat.get_rows_list(a);"undefined"==typeof c.sortable?alert("\u041f\u043b\u0430\u0433\u0438\u043d jquery.ui.sortable.js \u043d\u0435 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d!"):(c.sortable.hasOwnProperty("destroy")&&c.sortable("destroy"),c.sortable({update:function(c,b){hiweb_field_repeat.set_input_names(jQuery(this).closest(hiweb_field_repeat.selector));b.placeholder.find("[data-col]").each(function(){jQuery(this).trigger("hiweb-field-repeat-drag-update",
[jQuery(this),jQuery(this).closest("[data-row]"),a])})},distance:3,handle:"> [data-drag], > [data-drag] button, > [data-drag] i",helper:function(c,b){b.find("th, td").each(function(){jQuery(this).width(jQuery(this).width())});b.find("[data-col]").each(function(){jQuery(this).trigger("hiweb-field-repeat-dragged",[jQuery(this),jQuery(this).closest("[data-row]"),a])});return b},revert:!0,start:function(c,b){b.placeholder.height(b.helper.height());b.helper.find("[data-col]").each(function(){jQuery(this).trigger("hiweb-field-repeat-drag-start",
[jQuery(this),jQuery(this).closest("[data-row]"),a])})},stop:function(c,b){b.item.find("[data-col]").each(function(){jQuery(this).trigger("hiweb-field-repeat-drag-stop",[jQuery(this),jQuery(this).closest("[data-row]"),a])})}}))},getRandomColor:function(){for(var a="#",c=0;6>c;c++)a+="0123456789ABCDEF"[Math.floor(16*Math.random())];return a},set_input_names:function(a){a=jQuery(a);a.find("[data-row]").each(function(){jQuery(this).attr("data-row",jQuery(this).index())});a.find("[name]").each(function(){jQuery(this).attr("name",
hiweb_field_repeat.get_input_name(jQuery(this)))});a.find("> table > tbody[data-rows-message] [data-row-empty]").attr("data-row-empty",0<hiweb_field_repeat.get_rows(a).length?"1":"0")},get_input_name:function(a){a=jQuery(a);for(var c=[],e=10;0<e;){var b=a.closest("[data-col]");if(1!==b.length)return a.closest(".hiweb-field-repeat[data-input-name]").attr("data-input-name");a=a.attr("name").split("["+b.attr("data-col")+"]");1<a.length&&(a=a.pop(),""!==a&&c.push(a));c.push("["+b.attr("data-col")+"]");
b=b.closest("[data-row]");if(1!==b.length){console.warn("2: row not found");break}c.push("["+b.attr("data-row")+"]");b=b.closest(".hiweb-field-repeat[data-id]");1!==b.length&&console.warn("3: repeat not found");var $super_col=b.closest("[data-col]");if(1!==$super_col.length){c.push(b.attr("data-input-name"));break}else a=b;e--}return c.reverse().join("")},get_global_id:function(a){return jQuery(a).is("[data-global-id]")?jQuery(a).attr("data-global-id"):jQuery(a).closest("[data-global-id]").attr("data-global-id")},
get_name_id:function(a){return jQuery(a).is("[data-input-name]")?jQuery(a).data("input-name"):jQuery(a).closest("[data-input-name]").data("input-name")},click_add:function(a){a.preventDefault();if(jQuery(this).is('[data-action-add="flex-dropdown"]')){var c=jQuery(this).closest("[data-ctrl]").find("[data-sub-flex-dropdown]"),e=null;c.fadeIn().off("mouseover mouseout").on("mouseout",function(){e=setTimeout(function(){c.fadeOut()},1E3)}).on("mouseover",function(){clearTimeout(e)})}else{a=jQuery(this).is('[data-action-add="1"]');
var b=jQuery(this).closest(hiweb_field_repeat.selector),d=jQuery(this).is("[data-flex-id]")?jQuery(this).attr("data-flex-id"):"";""!==d&&jQuery(this).closest("[data-sub-flex-dropdown]").fadeOut();hiweb_field_repeat.add_rows(b,a,1,"",d)}},add_rows:function(a,c,e,b,d){"undefined"===typeof e&&(e=1);"undefined"===typeof c&&(c=!1);"undefined"===typeof d&&(d="");var f=hiweb_field_repeat.get_rows_list(a);b=c?0:hiweb_field_repeat.get_rows(a).length;jQuery.ajax({url:ajaxurl+"?action=hiweb-field-repeat-get-row",
type:"post",data:{id:hiweb_field_repeat.get_global_id(a),method:"ajax_html_row",input_name:hiweb_field_repeat.get_name_id(a),index:b,flex_row_id:d},dataType:"json",success:function(b){if(b.hasOwnProperty("result")&&!0===b.result){var d=jQuery(b.data).hide().fadeIn();for(n=0;n<e;n++)c?f.prepend(d):f.append(d),d.find("[data-col]").each(function(){jQuery(this).trigger("hiweb-field-repeat-add-new-row",[jQuery(this),d,a])}),d.find("> td").wrapInner('<div style="display: none;" />').parent().find("> td > div").slideDown(400,
function(){var b=jQuery(this);b.replaceWith(b.contents());d.find("[data-col]").each(function(){jQuery(this).trigger("hiweb-field-repeat-added-row-fadein",[jQuery(this),d,a]);jQuery(this).trigger("hiweb-field-repeat-added-new-row-fadein",[jQuery(this),d,a])})}),hiweb_field_repeat.set_input_names(a),d.find("[data-col]").each(function(){jQuery(this).trigger("hiweb-field-repeat-added-row",[jQuery(this),d,a]);jQuery(this).trigger("hiweb-field-repeat-added-new-row",[jQuery(this),d,a])})}else console.warn(b)},
error:function(a){console.warn(a)}})},paramsToArray:function(a,c){a=a.match(/(\[?[\d\w\-_]+\]?)/g);for(var e=temp={},b=0;b<a.length;b++){var d=a[b].replace(/^\[?([\d\w\-_]+)\]?/,"$1");temp=b===a.length-1?temp[d]=c:temp[d]={}}return e},click_duplicate:function(a){a.preventDefault();var c=jQuery(this).closest(hiweb_field_repeat.selector);hiweb_field_repeat.get_rows_list(c);var e=jQuery(this).closest(hiweb_field_repeat.selector_row),b=[],d=hiweb_field_repeat.get_input_name(this)+"["+e.attr("data-row")+
"]";e.find("[name]").each(function(){var a=jQuery(this).attr("name");0===a.indexOf(d)&&(a=a.substr(d.toString().length).replace(/^\[([\w\d\-_]+)\]/g,"$1"),b.push(hiweb_field_repeat.paramsToArray(a,jQuery(this).val())))});jQuery.ajax({url:ajaxurl+"?action=hiweb-field-repeat-get-row",type:"post",data:{id:hiweb_field_repeat.get_global_id(this),method:"ajax_html_row",row_index:e.attr("data-row"),values:deepMerge.all(b)},dataType:"json",success:function(a){if(a.hasOwnProperty("result")&&!0===a.result){var b=
jQuery(a.data).hide().fadeIn();e.after(b);b.find("[data-col]").each(function(){jQuery(this).trigger("hiweb-field-repeat-add-new-row",[jQuery(this),b,c])});b.css("opacity",0).animate({opacity:1}).find("> td").wrapInner('<div style="display: none;" />').parent().find("> td > div").slideDown(700,function(){var a=jQuery(this);a.replaceWith(a.contents());b.find("[data-col]").each(function(){jQuery(this).trigger("hiweb-field-repeat-cloned-row-fadein",[jQuery(this),b,c]);jQuery(this).trigger("hiweb-field-repeat-added-new-row-fadein",
[jQuery(this),b,c])})});hiweb_field_repeat.set_input_names(c);b.find("[data-col]").each(function(){jQuery(this).trigger("hiweb-field-repeat-cloned-row",[jQuery(this),b,c]);jQuery(this).trigger("hiweb-field-repeat-added-new-row",[jQuery(this),b,c])})}else console.warn(a)},error:function(a){console.warn(a)}})},click_remove:function(a){a.preventDefault();a=jQuery(this).closest(hiweb_field_repeat.selector_row);hiweb_field_repeat.do_remove_row(a)},do_remove_row:function(a){return jQuery(a).find("> td").wrapInner('<div style="display: block;" />').parent().find("> td > div").slideUp(700,
function(){var c=a.closest(hiweb_field_repeat.selector);jQuery(this).parent().parent().remove();a.remove();hiweb_field_repeat.set_input_names(c);0===hiweb_field_repeat.get_rows(c).length&&jQuery(c).find(".message").fadeIn()})},click_clear_full:function(a){a.preventDefault();confirm("Remove all table rows?")&&(a=jQuery(this).closest(hiweb_field_repeat.selector),hiweb_field_repeat.get_rows(a).each(function(){hiweb_field_repeat.do_remove_row(this)}))}};jQuery(document).ready(hiweb_field_repeat.init_once);
jQuery("body").on("hiweb-field-repeat-added-new-row","[data-col]",function(a,c,e,b){c.find(".hiweb-field-repeat").each(function(){hiweb_field_repeat.init(this)})});
