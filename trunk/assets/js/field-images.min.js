var hiweb_field_images={selector_root:".hiweb-field-images",init:function(){jQuery("body").on("click",'.hiweb-field-images [data-ctrl-sub="left"], .hiweb-field-images [data-ctrl-sub="right"]',function(a){a.preventDefault();hiweb_field_images.event_click_add(hiweb_field_images.get_root(this),"right"===jQuery(this).attr("data-ctrl-sub"))});jQuery("body").on("click",".hiweb-field-images [data-click-remove]",function(a){a.preventDefault();hiweb_field_images.event_click_remove(jQuery(this).closest("[data-image-id]"))});jQuery("body").on("click",".hiweb-field-images [data-click-reverse]",function(a){a.preventDefault();hiweb_field_images.event_click_reverse(this)});jQuery("body").on("click",".hiweb-field-images [data-click-random]",function(a){a.preventDefault();hiweb_field_images.event_click_random(this)});jQuery("body").on("click",".hiweb-field-images [data-click-clear]",function(a){a.preventDefault();hiweb_field_images.event_click_clear(this)});jQuery("body").on("click",".hiweb-field-images [data-click-add]",function(a){a.preventDefault();hiweb_field_images.event_click_add(hiweb_field_images.get_root(this),true)});jQuery("body").on("click",".hiweb-field-images [data-click-edit]",function(a){a.preventDefault();hiweb_field_images.event_click_edit(this)});hiweb_field_images.make_sortable();hiweb_field_images.make_dropdown()},shuffleElements:function(c){var b,h,g,a;var d=c.length;var e=c.parent();var f=[];for(b=0;b<d;b++){f.push(b)}for(b=0;b<d;b++){h=(Math.random()*d)|0;g=(Math.random()*d)|0;a=f[h];f[h]=f[g];f[g]=a}c.detach();for(b=0;b<d;b++){e.append(c.eq(f[b]))}},get_root:function(a){return jQuery(a).closest(".hiweb-field-images")},get_source:function(b){var a=hiweb_field_images.get_root(b);return a.find("[data-source]")},get_list_root:function(b){var a=hiweb_field_images.get_root(b);return a.find("[data-images-wrap]")},get_list_images:function(a){return hiweb_field_images.get_list_root(a).find("> [data-image-id]")},make_dropdown:function(){jQuery(hiweb_field_images.selector_root+" .dropdown").dropdown({action:"hide"})},make_sortable:function(){jQuery(".hiweb-field-images [data-images-wrap]").sortable({distance:5,cursor:"move",handle:".overlay, .button",helper:"original",revert:true})},event_click_add:function(a,b){var c=wp.media({title:"Выбор изображения",library:{type:"image"},multiple:true,button:{text:"Выбрать файлы"}});c.on("select",function(){c.state().get("selection").map(function(d){hiweb_field_images.select_image(a,b,d.toJSON())});hiweb_field_images.make_sortable()});c.open()},select_image:function(a,c,e){switch("object"){case typeof e.sizes.medium:var d=e.sizes.medium.url;break;case typeof e.sizes.large:var d=e.sizes.large.url;break;case typeof e.sizes.thumbnail:var d=e.sizes.thumbnail.url;break;case typeof e.sizes.full:var d=e.sizes.full.url;break;default:var d=false}var f=hiweb_field_images.get_source(a).clone();f.find("img").attr("src",d);f.removeAttr("data-source").attr("data-image-id",e);var b=f.find("input");b.val(e.id).attr("name",b.attr("data-name")).removeAttr("data-name");f.attr("id",a.attr("data-id"));f.attr("data-tooltip",e.filename);if(c){hiweb_field_images.get_list_root(a).append(f)}else{hiweb_field_images.get_list_root(a).prepend(f)}var g=hiweb_field_images.get_list_root(a).find("> li").length-1;a.attr("data-images-count",g);a.find("[data-images-count]").html(g)},event_click_edit:function(c){c=jQuery(c).closest("[data-image-id]");var d=c.attr("data-image-id");var b={title:"Обновление файла",multiple:false,button:{text:"Обновить файл"},library:{type:"image"}};var a=wp.media(b);a.on("open",function(){var e=a.state().get("selection");attachment=wp.media.attachment(d);attachment.fetch();e.add(attachment?[attachment]:[])});a.on("select",function(){a.state().get("selection").map(function(g){var e=g.toJSON().id;switch("object"){case typeof selection.sizes.medium:var f=selection.sizes.medium.url;break;case typeof selection.sizes.large:var f=selection.sizes.large.url;break;case typeof selection.sizes.thumbnail:var f=selection.sizes.thumbnail.url;break;case typeof selection.sizes.full:var f=selection.sizes.full.url;break;default:var f=false}})});a.open()},event_click_remove:function(a){jQuery(a).hide("slow",function(){jQuery(this).remove();hiweb_field_images.refresh_view(hiweb_field_images.get_root(this))})},event_click_reverse:function(b){var a=hiweb_field_images.get_list_root(b);a.children().each(function(d,c){a.prepend(c)})},event_click_random:function(b){var a=hiweb_field_images.get_list_root(b);hiweb_field_images.shuffleElements(a.find("li[data-image-id]"))},event_click_clear:function(b){if(confirm("Remove all images?")){hiweb_field_images.get_list_images(b).each(function(){hiweb_field_images.event_click_remove(this)});var a=hiweb_field_images.get_root(b);a.attr("data-images-count",0);a.find("[data-images-count]").attr("data-images-count",0)}},refresh_view:function(a){}};jQuery(document).ready(hiweb_field_images.init);